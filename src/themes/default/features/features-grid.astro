---
import LinksBlock from "../../../components/links-block.astro";

const { title, subTitle, excerpt, bgMood, links, gridColumns } = Astro.props;
const { features, summary, description } = Astro.props;

// Map bgMood to theme-aware background classes
const bgMoodClass =
  bgMood === "primary"
    ? "bg-primary-50 text-white dark:bg-primary-600 text-black"
    : bgMood === "secondary"
      ? "bg-secondary-50"
      : bgMood === "dark"
        ? "bg-base-900 text-white"
        : bgMood === "light"
          ? "bg-base-50"
          : "bg-transparent text-gray-900 dark:bg-transparent dark:text-white";
---

<section class={bgMoodClass}>
  <div class="relative py-24 mx-auto max-w-7xl px-6 lg:px-8">
    <!-- Features Heading Section -->
    <div class="max-w-3xl">
      <p class="text-sm leading-normal font-bold uppercase text-accent-600">
        {subTitle}
      </p>
      <h2
        class="text-xl leading-tight tracking-tight sm:text-2xl md:text-3xl lg:text-4xl mt-4 font-semibold text-base-900 lg:text-balance dark:text-black"
      >
        {title}
      </h2>
      <p class="text-base leading-normal mt-4 font-medium dark:text-black">
        {excerpt}
      </p>
      <p class="text-sm leading-normal mt-4 font-medium dark:text-black">
        {summary}
      </p>
      <p class="text-sm leading-normal mt-4 font-medium dark:text-black">
        {description}
      </p>
    </div>

    {gridColumns}

    <!-- Features Section -->
    <div
      class={`gap-x-2 gap-y-14 mt-12 lg:gap-12 grid ${gridColumns ? gridColumns : "grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"}`}
    >
      {
        features &&
          features.length > 0 &&
          features.map((feature) => (
            <div>
              <div>
                {/* Feature Icon - Small */}
                {feature.icon && (
                  <div class="mb-4">
                    <img
                      src={
                        feature.icon.url ||
                        `https://${feature.icon.prefix}/${feature.icon.filename}`
                      }
                      alt={feature.icon.alt || feature.title}
                      class="w-auto h-auto object-contain max-h-36"
                      width={feature.icon.width}
                      height={feature.icon.height}
                    />
                  </div>
                )}

                {/* Feature Image */}
                {feature.image && (
                  <div class="mb-4">
                    <img
                      src={
                        feature.image.url ||
                        `https://${feature.image.prefix}/${feature.image.filename}`
                      }
                      alt={feature.image.alt || feature.title}
                      class="w-auto h-auto object-contain"
                      width={feature.image.width}
                      height={feature.image.height}
                    />
                  </div>
                )}

                <h3 class="text-base leading-normal sm:text-lg md:text-xl  font-semibold text-base-900 dark:text-black">
                  {feature.title}

                  {feature.summary && feature.description && (
                    <span class="mt-2 text-sm text-accent-600 font-semibold text-base-500 dark:text-black">
                      — {feature.summary}
                    </span>
                  )}
                </h3>

                {feature.summary && !feature.description && (
                  <p class="text-base leading-normal mt-2  font-medium text-base-500 dark:text-black">
                    {feature.summary}
                  </p>
                )}

                {/* Features Tags */}
                {feature.tags && feature.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2 mt-2">
                    {feature.tags.map((tag) => (
                      <span class="inline-flex items-center rounded-md bg-accent-100 px-2 py-1 text-xs font-medium  dark:bg-accent-400/10 ">
                        {tag.title || tag.excerpt}
                      </span>
                    ))}
                  </div>
                )}
                {/* <span class="">Badge</span> */}

                {feature.description && (
                  <p class="text-base leading-normal mt-2 text-base-500 font-normal text-black dark:text-black">
                    {feature.description}
                  </p>
                )}

                {feature.ref && feature.refURL && (
                  <a
                    href={feature.refURL}
                    {...(feature.refURL.startsWith("http")
                      ? { target: "_blank", rel: "noopener noreferrer" }
                      : {})}
                    class="inline-flex items-center gap-1 mt-3 text-sm font-semibold text-primary-600 hover:text-primary-700 transition-colors"
                  >
                    {feature.ref}
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      />
                    </svg>
                  </a>
                )}

                <LinksBlock
                  {...{
                    links: feature.links,
                    bgMood,
                    clazz: "flex-col items-start justify-start mt-3",
                  }}
                />
              </div>
            </div>
          ))
      }
    </div>

    {
      links && links.length > 0 && (
        <div class="mt-8 flex flex-wrap items-center gap-4">
          {links.map((link, index) => {
            if (!link || Object.keys(link).length === 0) return null;

            const isPrimary = index === 0;
            let href = "#";
            let isExternal = false;

            if (link.type === "internal" && link.internalLink?.value?.slug) {
              href = `/${link.internalLink.value.slug}`;
            } else if (link.type === "external" && link.externalLink) {
              href = link.externalLink;
              isExternal = true;
            } else if (link.url) {
              href = link.url;
              isExternal = link.url.startsWith("http");
            }

            const linkProps = isExternal
              ? { target: "_blank", rel: "noopener noreferrer" }
              : {};

            // Determine variant: use link.variant if provided, otherwise default to primary for first, link for others
            const variant = link.variant || (isPrimary ? "primary" : "link");

            // Define button styles based on variant
            let buttonClass = "";
            let showArrow = false;

            switch (variant) {
              case "primary":
                buttonClass =
                  "inline-flex items-center justify-center rounded-lg bg-primary-600 text-white hover:bg-primary-700 px-6 py-3 text-sm font-semibold shadow-sm transition-colors";
                break;
              case "secondary":
                buttonClass =
                  "inline-flex items-center justify-center rounded-lg border-2 border-primary-600 text-primary-600 hover:bg-primary-50 px-6 py-3 text-sm font-semibold transition-colors";
                break;
              case "outline":
                buttonClass =
                  "inline-flex items-center justify-center rounded-lg border border-gray-300 text-gray-900 hover:border-primary-600 hover:text-primary-600 px-6 py-3 text-sm font-semibold transition-colors";
                break;
              case "ghost":
                buttonClass =
                  "inline-flex items-center justify-center rounded-lg text-gray-900 hover:bg-gray-100 px-6 py-3 text-sm font-semibold transition-colors";
                break;
              case "link":
                buttonClass =
                  "inline-flex items-center justify-center text-sm font-semibold text-gray-900 hover:text-primary-600 transition-colors";
                showArrow = true;
                break;
              default:
                buttonClass =
                  "inline-flex items-center justify-center rounded-lg bg-primary-600 text-white hover:bg-primary-700 px-6 py-3 text-sm font-semibold shadow-sm transition-colors";
            }

            return (
              <a href={href} {...linkProps} class={buttonClass}>
                {link?.label || link?.text || "Learn More"}
                {showArrow && (
                  <span class="ml-1" aria-hidden="true">
                    →
                  </span>
                )}
              </a>
            );
          })}
        </div>
      )
    }
    <!-- <div class="w-full mt-12 -mb-12">
      <img
        src="/images/dashboardLight.svg"
        alt="#_"
        class="w-full shadow rounded-t-2xl"
      />
    </div> -->
  </div>
</section>
