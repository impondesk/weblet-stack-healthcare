---
const { subTitle, title, excerpt, links, bgMood, heroImage } = Astro.props;

// Build the full image URL
const imageUrl = heroImage?.url || (heroImage?.prefix && heroImage?.filename 
  ? `https://${heroImage.prefix}/${heroImage.filename}` 
  : null);
---

<section class="relative py-12 min-h-[500px] flex items-center">
  {imageUrl && (
    <>
      <!-- Background Image -->
      <div 
        class="absolute inset-0 bg-cover bg-center z-0"
        style={`background-image: url('${imageUrl}'); background-position: ${heroImage?.focalX || 50}% ${heroImage?.focalY || 50}%;`}
      ></div>
      
      <!-- Elegant Overlay with gradient - increased opacity for better text readability -->
      <div class="absolute inset-0 bg-gradient-to-b from-black/50 via-black/60 to-black/70 z-0"></div>
      
      <!-- Optional blur backdrop for better text readability -->
      <div class="absolute inset-0 backdrop-blur-[4px] z-0"></div>
    </>
  )}
  
  <!-- Content Container - positioned above background -->
  <div class={`relative z-10 w-full ${imageUrl ? 'max-w-7xl mx-auto px-4 py-8' : ''}`}>
  <p class={`mt-2 text-base uppercase font-semibold text-center ${imageUrl ? 'text-white drop-shadow-lg' : ''}`}>
    {subTitle}
  </p>
  <p class={`mt-4 text-balance text-center font-semibold text-xl/8 sm:text-5xl ${imageUrl ? 'text-white drop-shadow-2xl' : ''}`}>
    {title}
  </p>
  <p class={`max-w-5xl mt-4 text-center mx-auto text-xl/8 ${imageUrl ? 'text-gray-100 drop-shadow-lg' : 'text-gray-500'}`}>
    {excerpt}
  </p>

  {
    links && links.length > 0 && (
      <div class="mt-10 flex flex-wrap items-center justify-center gap-4 lg:gap-x-6">
        {links.map((link, index) => {
          // Skip empty links
          if (!link || Object.keys(link).length === 0) return null;

          const isPrimary = index === 0;

          // Determine the URL based on link type
          let href = "#";
          let isExternal = false;

          if (link.type === "internal" && link.internalLink?.value?.slug) {
            // Internal link - use slug
            href = `/${link.internalLink.value.slug}`;
          } else if (link.type === "external" && link.externalLink) {
            // External link
            href = link.externalLink;
            isExternal = true;
          } else if (link.url) {
            // Fallback to direct URL property
            href = link.url;
            isExternal = link.url.startsWith("http");
          }

          const linkProps = isExternal
            ? { target: "_blank", rel: "noopener noreferrer" }
            : {};

          return (
            <a
              href={href}
              {...linkProps}
              class={
                isPrimary
                  ? `inline-flex items-center justify-center rounded-lg ${
                      bgMood === "dark"
                        ? "bg-white text-gray-900 hover:bg-gray-100"
                        : "bg-blue-600 text-white hover:bg-blue-700"
                    } px-5 py-3 text-sm font-semibold shadow-sm transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600`
                  : `inline-flex items-center justify-center text-sm font-semibold ${
                      bgMood === "dark"
                        ? "text-white hover:text-gray-200"
                        : "text-gray-900 hover:text-gray-700"
                    } transition-colors`
              }
            >
              {link?.label || link?.text || "Learn more"}
              {!isPrimary && (
                <span class="ml-1" aria-hidden="true">
                  â†’
                </span>
              )}
            </a>
          );
        })}
      </div>
    )
  }
  </div>
</section>

<!-- {JSON.stringify(video)} -->

<!-- <section>
  {
    video && video?.link && (
      <div class="mx-auto max-w-5xl">
        <center>
          <video class="h-full w-full l rounded-lg" controls autoplay muted>
            <source src={video?.link} type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </center>
      </div>
    )
  }
</section> -->
