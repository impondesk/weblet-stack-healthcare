---
import { themeConfig } from '../theme-config';

const { subTitle, title, excerpt, links, bgMood, heroImage } = Astro.props;

// Build the full image URL
const imageUrl = heroImage?.url || (heroImage?.prefix && heroImage?.filename 
  ? `https://${heroImage.prefix}/${heroImage.filename}` 
  : null);

// Determine theme mode based on image presence and bgMood
const hasImage = Boolean(imageUrl);
const isDarkMode = bgMood === 'dark';

// Get hero theme configuration
const heroTheme = themeConfig.components.hero.default;

// Helper function to get color based on mode
const getColor = (colorConfig: any) => {
  if (hasImage) return colorConfig.withImage;
  if (isDarkMode) return colorConfig.dark;
  return colorConfig.light;
};

// Generate style strings from theme config
const subtitleColor = getColor(heroTheme.subtitle.color);
const titleColor = getColor(heroTheme.title.color);
const excerptColor = getColor(heroTheme.excerpt.color);

// Primary button colors and styles
const primaryButtonConfig = getColor(heroTheme.cta.primary);
const primaryButtonBg = primaryButtonConfig.background;
const primaryButtonBgHover = primaryButtonConfig.backgroundHover;
const primaryButtonText = primaryButtonConfig.text;
const primaryButtonShadow = primaryButtonConfig.shadow;

// Secondary button colors
const secondaryButtonConfig = getColor(heroTheme.cta.secondary);
const secondaryButtonText = secondaryButtonConfig.text;
const secondaryButtonTextHover = secondaryButtonConfig.textHover;

// Focus outline color from theme
const focusOutlineColor = themeConfig.colors.border[isDarkMode ? 'dark' : 'light'].focus;
---

<section 
  class="relative flex items-center"
  style={`min-height: ${heroTheme.minHeight}; padding-top: ${heroTheme.padding.y}; padding-bottom: ${heroTheme.padding.y};`}
>
  {imageUrl && (
    <>
      <!-- Background Image -->
      <div 
        class="absolute inset-0 bg-cover bg-center z-0"
        style={`background-image: url('${imageUrl}'); background-position: ${heroImage?.focalX || 50}% ${heroImage?.focalY || 50}%;`}
      ></div>
      
      <!-- Elegant Overlay with gradient -->
      <div 
        class="absolute inset-0 z-0"
        style={`background: ${heroTheme.overlay.gradient};`}
      ></div>
      
      <!-- Optional blur backdrop for better text readability -->
      <div 
        class="absolute inset-0 z-0"
        style={`backdrop-filter: blur(${heroTheme.overlay.backdropBlur});`}
      ></div>
    </>
  )}
  
  <!-- Content Container - positioned above background -->
  <div 
    class={`relative z-10 w-full mx-auto ${imageUrl ? 'px-4 py-8' : ''}`}
    style={`max-width: ${imageUrl ? heroTheme.container.maxWidth : 'none'};`}
  >
    <!-- Subtitle -->
    <p 
      class="text-center"
      style={`
        margin-top: ${heroTheme.subtitle.marginTop};
        font-size: ${heroTheme.subtitle.fontSize};
        font-weight: ${heroTheme.subtitle.fontWeight};
        text-transform: ${heroTheme.subtitle.textTransform};
        color: ${subtitleColor};
        ${hasImage ? 'text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);' : ''}
      `}
    >
      {subTitle}
    </p>

    <!-- Title -->
    <p 
      class="text-balance text-center"
      style={`
        margin-top: ${heroTheme.title.marginTop};
        font-size: ${heroTheme.title.fontSize.sm};
        font-weight: ${heroTheme.title.fontWeight};
        line-height: ${heroTheme.title.lineHeight};
        color: ${titleColor};
        ${hasImage ? 'text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);' : ''}
      `}
    >
      {title}
    </p>

    <!-- Excerpt -->
    <p 
      class="mx-auto text-center"
      style={`
        max-width: ${heroTheme.excerpt.maxWidth};
        margin-top: ${heroTheme.excerpt.marginTop};
        font-size: ${heroTheme.excerpt.fontSize};
        line-height: ${heroTheme.excerpt.lineHeight};
        color: ${excerptColor};
        ${hasImage ? 'text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);' : ''}
      `}
    >
      {excerpt}
    </p>

  {
    links && links.length > 0 && (
      <div 
        class="flex flex-wrap items-center justify-center"
        style={`
          margin-top: ${heroTheme.cta.marginTop};
          gap: ${heroTheme.cta.gap};
        `}
      >
        {links.map((link, index) => {
          // Skip empty links
          if (!link || Object.keys(link).length === 0) return null;

          const isPrimary = index === 0;

          // Determine the URL based on link type
          let href = "#";
          let isExternal = false;

          if (link.type === "internal" && link.internalLink?.value?.slug) {
            // Internal link - use slug
            href = `/${link.internalLink.value.slug}`;
          } else if (link.type === "external" && link.externalLink) {
            // External link
            href = link.externalLink;
            isExternal = true;
          } else if (link.url) {
            // Fallback to direct URL property
            href = link.url;
            isExternal = link.url.startsWith("http");
          }

          const linkProps = isExternal
            ? { target: "_blank", rel: "noopener noreferrer" }
            : {};

          return (
            <a
              href={href}
              {...linkProps}
              class="inline-flex items-center justify-center hero-cta-button"
              data-variant={isPrimary ? 'primary' : 'secondary'}
              style={
                isPrimary
                  ? `
                    background-color: ${primaryButtonBg};
                    color: ${primaryButtonText};
                    padding: ${heroTheme.cta.padding.y} ${heroTheme.cta.padding.x};
                    font-size: ${heroTheme.cta.fontSize};
                    font-weight: ${heroTheme.cta.fontWeight};
                    border-radius: ${heroTheme.cta.borderRadius};
                    box-shadow: ${primaryButtonShadow};
                    transition: ${heroTheme.cta.transition};
                    border: none;
                    cursor: pointer;
                    text-decoration: none;
                  `
                  : `
                    color: ${secondaryButtonText};
                    font-size: ${heroTheme.cta.fontSize};
                    font-weight: ${heroTheme.cta.fontWeight};
                    transition: ${heroTheme.cta.transition};
                    background: transparent;
                    border: none;
                    cursor: pointer;
                    text-decoration: none;
                  `
              }
            >
              {link?.label || link?.text || "Learn more"}
              {!isPrimary && (
                <span class="ml-1" aria-hidden="true">
                  â†’
                </span>
              )}
            </a>
          );
        })}
      </div>
    )
  }
  </div>
</section>

<style define:vars={{
  primaryButtonBgHover,
  secondaryButtonTextHover,
  focusOutlineColor
}}>
  .hero-cta-button {
    position: relative;
    overflow: hidden;
  }
  
  /* Primary button styles */
  .hero-cta-button[data-variant="primary"]:hover {
    background-color: var(--primaryButtonBgHover);
    transform: translateY(-1px);
    box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.2);
  }
  
  .hero-cta-button[data-variant="primary"]:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
  }
  
  .hero-cta-button[data-variant="primary"]:focus-visible {
    outline: 2px solid var(--focusOutlineColor);
    outline-offset: 2px;
  }
  
  /* Secondary button styles */
  .hero-cta-button[data-variant="secondary"]:hover {
    color: var(--secondaryButtonTextHover);
  }
  
  .hero-cta-button[data-variant="secondary"]:hover span {
    transform: translateX(4px);
    display: inline-block;
    transition: transform 150ms ease-out;
  }
  
  .hero-cta-button[data-variant="secondary"]:focus-visible {
    outline: 2px solid var(--focusOutlineColor);
    outline-offset: 2px;
    border-radius: 4px;
  }
  
  /* Ripple effect for primary button (optional) */
  .hero-cta-button[data-variant="primary"]::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }
  
  .hero-cta-button[data-variant="primary"]:active::before {
    width: 300px;
    height: 300px;
  }
</style>

<!-- {JSON.stringify(video)} -->

<!-- <section>
  {
    video && video?.link && (
      <div class="mx-auto max-w-5xl">
        <center>
          <video class="h-full w-full l rounded-lg" controls autoplay muted>
            <source src={video?.link} type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </center>
      </div>
    )
  }
</section> -->
