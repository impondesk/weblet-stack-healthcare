---
import SectionTitle from "../section-title.astro";
import TestimonialDefaultItem from "./testimonial-default-item.astro";

const { testimonials, bgMood, links } = Astro.props;

const bgClass = bgMood === "dark" ? "bg-gray-900 text-white" : "bg-transparent";
---

{JSON.stringify(testimonials)}

<section class={`py-16 sm:py-24 ${bgClass}`}>
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <SectionTitle {...Astro.props} />

    {
      testimonials && testimonials.length > 0 && (
        <div class="mt-16 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {testimonials.map((testimonial) => (
            <div>
              {/* Debug: Show comment directly */}
              <div style={{ color: "red", fontSize: "0.9em" }}>
                {testimonial.comment}
              </div>
              <TestimonialDefaultItem {...testimonial} />
            </div>
          ))}
        </div>
      )
    }

    {
      links && links.length > 0 && (
        <div class="mt-12 flex flex-wrap items-center justify-center gap-4 lg:gap-x-6">
          {links.map((link, index) => {
            if (!link || Object.keys(link).length === 0) return null;

            const isPrimary = index === 0;
            let href = "#";
            let isExternal = false;

            if (link.type === "internal" && link.internalLink?.value?.slug) {
              href = `/${link.internalLink.value.slug}`;
            } else if (link.type === "external" && link.externalLink) {
              href = link.externalLink;
              isExternal = true;
            } else if (link.url) {
              href = link.url;
              isExternal = link.url.startsWith("http");
            }

            const linkProps = isExternal
              ? { target: "_blank", rel: "noopener noreferrer" }
              : {};

            return (
              <a
                href={href}
                {...linkProps}
                class={
                  isPrimary
                    ? `inline-flex items-center justify-center rounded-lg ${
                        bgMood === "dark"
                          ? "bg-white text-gray-900 hover:bg-gray-100"
                          : "bg-blue-600 text-white hover:bg-blue-700"
                      } px-5 py-3 text-sm font-semibold shadow-sm transition-colors`
                    : `inline-flex items-center justify-center text-sm font-semibold ${
                        bgMood === "dark"
                          ? "text-white hover:text-gray-200"
                          : "text-gray-900 hover:text-gray-700"
                      } transition-colors`
                }
              >
                {link?.label || link?.text || "View More"}
                {!isPrimary && (
                  <span class="ml-1" aria-hidden="true">
                    â†’
                  </span>
                )}
              </a>
            );
          })}
        </div>
      )
    }
  </div>
</section>
