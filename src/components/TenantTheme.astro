---
/**
 * Tenant Theme Injector
 *
 * This component loads tenant-specific theme CSS from static file or generates inline CSS.
 * Priority:
 * 1. Load from /themes/{tenantId}.css (if exists in public/)
 * 2. Fallback to inline CSS generation from API themeConfig
 */

// Get tenant data
const hasTenantData = !!Astro.locals.tenant;
const tenantId = Astro.locals?.tenant?.id;
const themeCSSVars = Astro.locals.themeCSSVars || {};

console.log("=== TenantTheme Component ===");
console.log("Has Tenant Data:", hasTenantData);
if (hasTenantData) {
  console.log("Tenant Name:", Astro.locals.tenant.name);
  console.log("Tenant ID:", tenantId);
}
console.log("CSS Vars Count:", Object.keys(themeCSSVars).length);

// Build CSS file path for static theme files
const tenantCssPath = tenantId ? `/themes/${tenantId}.css` : null;

// Convert CSS vars object to inline style string with !important
const styleString = Object.entries(themeCSSVars)
  .map(([key, value]) => `  ${key}: ${value} !important;`)
  .join("\n");

// Build complete CSS string for inline fallback
const fullCssString = `:root, html {\n${styleString}\n}`;

console.log("Tenant CSS Path:", tenantCssPath || "None");
console.log("Inline CSS Length:", styleString.length);
if (styleString.length > 0) {
  console.log("✓ Inline CSS available as fallback");
} else {
  console.log("⚠ No inline CSS - will use defaults");
}
console.log("=== End TenantTheme ===\n");
---

<!-- Try to load tenant CSS from static file first -->{
  tenantCssPath && <link rel="stylesheet" href={tenantCssPath} />
}

<!-- Fallback: Inject inline CSS if no static file exists -->
{
  !tenantCssPath && styleString.length > 0 && (
    <style is:inline set:html={fullCssString} />
  )
}

<!-- Debug: Show tenant theme status -->
<!-- Tenant ID: {tenantId || 'None'} | CSS File: {tenantCssPath || 'None'} | Inline Vars: {Object.keys(themeCSSVars).length} -->
